# Построитель графиков



Установка проекта:&#x20;

pip3 install -r requirements.txt

python3 ./main.py

### Работа с приложением:&#x20;

_Появилась защита от дурака, заглушки на некоторые нажатия_

В приложении на данный момент доступно 4 вида графиков: Линия, круговая, столбчатая диограммы, гистограмма. Для всех графиков доступен ввод данных из csv-файлов. Для линии доступен текстовый ввод. Тип графиков можно выбрать в левой панели. Чтобы добавить график, нужно нажать на кнопку +. При выбранном типе графика "линия" появится поля для текстового ввода функции. В остальных случаях - для файлового.

Текстовый ввод: Функция вводится математическими формулами, с обозначениями "+" - для сложения, "-" - для вычитания, "\*" - для умножения, "/" - для деления, "^" - для степени, "sin(x)", "cos(x)", "tan(x)", "arcsin(x)", "arccos(x)", "arctan(x)" - для соответствующих тригонометрических функций, "log(x)" - для натурального логарифма, "log10(x)" - для десятичного логарифма. Обозначение для координаты по вертикали "y", по горизонтали - "x". Чтобы подтвердить функцию, нужно нажать на "+" справа от формулы. Чтобы удалить функцию, нужно нажать на "-". Чтобы перейти в режим файлового ввода нужно нажать на кнопку F. Пример ввода функций: "y = sin(x)", "y + x = 5"

Файловый ввод: Нужно нажать на кнопку для выбора файла. Откроется соответствующее окно. После выбора график будет построен. Удалить график можно кнопкой "-". При типе графиков "линия" можно сменить ввод на текстовый кнопкой "Т". Формат файлов: Файлы должны иметь расширение csv с delimeter=",". Для всех графиков, кроме гистограммы должно быть две колонки: названия/координаты по Ox, значения/координаты по Oy. Для гистограммы одна колонка со значениями. В значениях круговой диаграммы не должно быть отрицательных чисел. У столбцов не должно быть заголовков. Примеры файлов в папке test\_files: first, second - графики, pie - круговая, столбчатая, hist - гистограмма

Линейный график: Для него доступно масштабирование по осям Ox и Oy (горизонатльный и вертикальный слайдер соответственно), перемещение по графику. Если вводятся несколько графиков, то они строятся на одном полотне. Масштабирование/перемещение производится соответствующими кнопками, или клавишами "вверх"/"вниз", "влево"/"вправо" для перемещения; "ctrl + =" / "ctrl + -" для масштабирования

Остальные графики: Если вводится несколько графиков, то они строятся на разных полотнах


### Тестирование исключений
запустить файл exception_test.py:

python tests/exception_tests.py


### Работа с telegram
Функциональность та же, но без масштабирования
Начать работу с ботом через "/start"
Чтобы выбрать тип графика нужно ввести "/plot", "/pie", "/bar" или "/hist"
Чтобы ввести функцию текста: "/func x + y = 5"
После добавления графика выводится его идентификатор id. По нему можно удалять: "/delete id"
Графики не отображаются после каждого добавления, чтобы отобразить нужно ввести "/download"
Закончить работу с ботом через "/stop"


### Тестирование работы с telegram
Код бота находится в telegram_gui/telegram_gui.py
Проверить, что конкретно этот код рабочий можно подставив созданный через BotFather токен

Проверить, что что-то рабочее есть, можно запустив в телеграме @graph_builder_bot







### Тестирование логики

В папке tests лежит файл logic\_test.py, который можно запустить. Ниже примеры кода со схожей с logic\_test логикой, но для ручной проверки.

1. Метод read\_csv класса FileHandler должен принимать на вход путь к файлу, возвращать считанный pandas.DataFrame Пример:&#x20;

```python
import handlers.file_handler 
import pandas as pd

print(handlers.file_handler.FileHandler.read_csv("./test_files/first.csv")) 

```

2\. Класс StringParser конструируется от уравнения. Имеет методы check(vars, calc\_error), принимающий словарь vars = {"x": подставляемое значение по Ox, "y": подставляемое значение по Oy} и calc\_error - допустимая погрешность ответа, reload - вспомогательный метод, должен быть вызыван при смене вычисляемого класса StringParser.  Пример:&#x20;

```python
import handlers.string_handler 
import handlers.string_handler
s1 = handlers.string_handler.StringParser("y = x^2", {"x": 0.0, "y": 0.0})
print(s1.check({"x": 0, "y": 0}, 0.01))
print(s1.check({"x": 0, "y": 1}, 0.01))
print(s1.check({"x": 0, "y": 1}, 2))
s2 = handlers.string_handler.StringParser("y = sin(x)", {"x": 0.0, "y": 0.0})
print(s2.check({"x": 0, "y": 0}, 0.01))
print(s2.check({"x": 0, "y": 1}, 0.01))
print(s2.check({"x": 0, "y": 1}, 2))
s1.reload()
print(s1.check({"x": 0.5, "y": 0.5}, 0.1))
print(s1.check({"x": 0.5, "y": 0.5}, 0.5))
```

3\. Классы хранящие данные графа:

1. Base - конструируется от pandas.DataFrame. Имеет метод get\_data, возвращающий dataframe. Используется для всех графиков, кроме графиков функций.&#x20;
2. Graph  - наследник Base. Имеет метод change\_range(x\_min, x\_max, y\_min, y\_max) - меняющий видимый диапазон. Может быть пустым. Используется для графиков, для которых создали поле ввода, но не ввели сам график.
3. FileGraph - наследник класса Graph. Используется для хранения введенных из файла данных. Вообще говоря ничего полезного не делает. На его диапазон обращает внимание GraphDataHandler при добавлении графика, чтобы возможно уменьшить масштаб (сейчас по умолчанию отображаются все точки файловых графиков). Класс отдельный так как в теории можно было бы работать с большими файлами. Тогда надо было бы частично хранить график, при изменении диапазона менять возвращаемое значение get\_data
4. TextGraph - наследник класса Graph. Конструируется от строки с математической формулой. Хранит объект типа StringParser. При изменении диапазона пересчитывает свои значения

Пример:

```python
import graph
import pandas as pd
base = graph.Base()
base_with_data = graph.Base(pd.DataFrame([
    [0, 4], [1, 3], [2, 2], [3, 1], [4, 0]
]))
empty_graph = graph.Graph()
file_graph = graph.FileGraph(pd.DataFrame([
    [0, 4], [1, 3], [2, 2], [3, 1], [4, 0]
]))
math_graph = graph.TextGraph("x - y = 3")
print("Base", base.get_data())
print("BaseWithData", base_with_data.get_data())
print("EmptyGraph", empty_graph.get_data())
print("FileGraph", file_graph.get_data())
print("MathGraph", math_graph.get_data())
empty_graph.change_range(4, 10, 4, 10)
file_graph.change_range(4, 10, 4, 10)
math_graph.change_range(4, 10, 4, 10)
print("EmptyGraph", empty_graph.get_data())
print("FileGraph", file_graph.get_data())
print("MathGraph", math_graph.get_data())

```

4\. Классы, управляющий данными графов

1. BaseDataHandler - для всех кроме графиков функций. Хранит список графиков. Имеет метод imaginary\_add() добавления пустого графика (графика, для которого создали поле ввода, но не ввели сам график), метод замены графика по индексу add\_graph(graph, index), метод удаления графика remove\_graph(index), метод удаления всех графиков clear(), метод size(), возвращающий количество графиков, метод get\_data(index), возвращающий данные
2. GraphDataHandler - наследник BaseDataHandler - реализует дополнительно работу с диапазонами. move(x\_percent, y\_percent) - сдвинуть диапазоны на x\_percent от текущего диапазона вправо y\_percent от текущего диапазона вверх. change\_scale(x\_precent, y\_percent) - увеличить масштаб на x\_percent по Ox y\_percent по Oy. update\_data применить изменения диапазонов ко всем графикам

Пример:

```python
import graph
import pandas as pd
import handlers.graph_handler


def print_graph(data_handler):
    for i in range(data_handler.size()):
        print(data_handler.get_data(i))
    print("-----------------------------\n\n")


graph_data_handler = handlers.graph_handler.GraphDataHandler()
graph_data_handler.imaginary_add()
graph_data_handler.imaginary_add()
graph_data_handler.imaginary_add()
graph_data_handler.add_graph(graph.TextGraph("x + y = 5"), 1)
data = pd.DataFrame(columns=[0, 1])
data[0] = [0, 1, 2, 3, 4]
data[1] = [4, 3, 2, 1, 0]
graph_data_handler.add_graph(graph.FileGraph(data), 2)
print("Первый график пустой, второй из многих сгенерированных точек, "
      "третий из значений dataframe:")
print_graph(graph_data_handler)

graph_data_handler.change_scale(50, 10)
print("Первый все еще пустой, второй поменял диапазон, третий не изменился:")
print_graph(graph_data_handler)

graph_data_handler.move(50, 10)
print("Первый все еще пустой, второй поменял диапазон, третий не изменился:")
print_graph(graph_data_handler)

graph_data_handler.remove_graph(1)
print("Удалился второй")
print_graph(graph_data_handler)

```

